<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> iOSé€†å‘å·¥ç¨‹å®è·µ Â· 0x5eçš„åšå®¢</title><meta name="description" content="iOSé€†å‘å·¥ç¨‹å®è·µ - 0x5e"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.0x5e.cn/atom.xml" title="0x5eçš„åšå®¢"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/imgs/avatar.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/0x5e" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/links/" target="_self" class="nav-list-link">LINK</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">iOSé€†å‘å·¥ç¨‹å®è·µ</h1><div class="post-info">Aug 24, 2016</div><div class="post-content"><p>å€Ÿä¸€æ¬¡å¸®åŒå­¦ç ´è§£æŸå¥‡è‘©çš„appçš„æœºä¼šï¼Œåˆæ­¥äº†è§£å¹¶æŒæ¡äº†iOSé€†å‘ç›¸å…³çŸ¥è¯†ã€‚</p>
<a id="more"></a>
<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><p>è§£å‡ºæŸä¸ªç±»ä¼¼æŒ–çŸ¿çš„appçš„é€šä¿¡åè®®ï¼Œç„¶åå†™ä¸ªè„šæœ¬è‡ªåŠ¨æŒ–çŸ¿</p>
<h2 id="äº†è§£"><a href="#äº†è§£" class="headerlink" title="äº†è§£"></a>äº†è§£</h2><p>å¼€å§‹ä¸€å¤´é›¾æ°´ï¼Œappèƒ½æŒ–çŸ¿ï¼Ÿç”¨äº†ä¸€æ®µæ—¶é—´æ‰å¤§è‡´äº†è§£ä»–çš„åŸç†ã€‚ã€‚</p>
<p>è¿™ä¸ªappéœ€è¦é€šè¿‡è“ç‰™è¿æ¥ä¸€ä¸ªç‰¹å®šç©¿æˆ´è®¾å¤‡ï¼Œä¿æŒè®¾å¤‡è¿è¡Œï¼Œé‡‡é›†æ‰€è°“çš„è„‘ç”µæ³¢ã€‚ã€‚é‡‡é›†çš„æ—¶é—´è¶Šé•¿ï¼Œè„‘ç”µæ³¢å›¾å½¢è¶Šå¥½ï¼Œæœ€ç»ˆæ•°æ®ä¸Šä¼ åˆ°æœåŠ¡ç«¯ï¼Œå¾—åˆ†å°±è¶Šé«˜ã€‚</p>
<p>ç½®äºå¥‡è‘©çš„appåšè¿™äº‹å„¿æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ã€‚åˆ†æ•°å¯ä»¥æ¢æˆè™šæ‹Ÿè´§å¸ï¼Œè€Œè¿™è´§å¸æœ€ç»ˆæ˜¯ä¹°å•çš„å‘¢ï¼Œå…¶å®é‡Œé¢è¿˜æœ‰ä¸ªè§„åˆ™æ˜¯å‘å±•ä¸‹çº¿ï¼Œå¯ä»¥ä»ä¸‹çº¿çš„å¾—åˆ†å¾—åˆ°ææˆï¼Œç„¶åæ¯ä¸ªäººéƒ½éœ€è¦èŠ±é’±ä¹°è¿™ä¸ªç©¿æˆ´è®¾å¤‡æ‰èƒ½é‡‡é›†å›¾å½¢ï¼Œæ¢å–ç§¯åˆ†ï¼Œæ‰€ä»¥é’±æœ€ç»ˆæ˜¯ä»ä¸‹å®¶ä¹°çš„è®¾å¤‡è¿™é‡Œæ¥çš„ï¼Œç±»ä¼¼äºã€‚ã€‚ã€‚ã€‚ä½ æ‡‚å¾—</p>
<h2 id="é€†å‘å‰çš„åˆ†æ"><a href="#é€†å‘å‰çš„åˆ†æ" class="headerlink" title="é€†å‘å‰çš„åˆ†æ"></a>é€†å‘å‰çš„åˆ†æ</h2><p>å…ˆæŠ“åŒ…çœ‹äº†ä¸€ä¸‹ç½‘ç»œè¯·æ±‚ï¼Œå‘ç°å‘é€å’Œæ¥æ”¶çš„æ•°æ®éƒ½ç»è¿‡base64ç¼–ç äº†ï¼Œè§£å‡ºæ¥æ˜¯ä¸€å †ä¹±ç ï¼Œçœ‹æ¥æ˜¯åŠ å¯†è¿‡å•¦ã€‚ï¼ˆä¸ç„¶ä¹Ÿä¸ç”¨å†™è¿™ç¯‡æ–‡ç« äº†- -llï¼‰</p>
<p>ç„¶åæˆ‘å…ˆåç¼–è¯‘å®‰å“ç‰ˆæœ¬çœ‹äº†ä¸€ä¸‹ï¼ˆè¿™ä¸ªæœ‰ç°æˆå·¥å…·æ¯”è¾ƒå¥½æï¼‰ï¼Œè²Œä¼¼æ˜¯ç”¨çˆ±åŠ å¯†åŠ å›ºè¿‡äº†ï¼Œå¾ˆå¤šå…³é”®çš„å‡½æ•°éƒ½åç¼–è¯‘å¤±è´¥äº†çœ‹ä¸åˆ°ï¼Œä¸è¿‡è¿˜æ˜¯çœ‹åˆ°äº†ä¸€äº›çº¿ç´¢ï¼šæ‰¾åˆ°ä¸¤ä¸ªå’ŒAESã€RSAç›¸å…³çš„ç±»åï¼Œä»¥åŠä¸€ä¸ªgetPubKey()å‡½æ•°ï¼Œé‡Œé¢åº”è¯¥æ˜¯RSAå…¬é’¥ã€‚äºæ˜¯çŒœæƒ³æ•°æ®åº”è¯¥æ˜¯ç»è¿‡AESå’ŒRSAåŠ å¯†äº†ã€‚</p>
<p>äºæ˜¯ç¢°åˆ°ä¸€ä¸ªå‘ï¼špythonæ²¡æ³•ç”¨å…¬é’¥è§£å¯†æ•°æ®ã€‚ã€‚ã€‚æœäº†å¾ˆä¹…ï¼Œè§£å†³æ–¹æ¡ˆéƒ½æ˜¯ä¸€æœ¬æ­£ç»åœ°è¯´ï¼Œä½ ä¸åº”è¯¥ç”¨ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ï¼Œè¿™æ ·åšæ˜¯ä¸å¯¹çš„</p>
<p>(â•¯â€µâ–¡â€²)â•¯ï¸µâ”»â”â”»</p>
<p>å¯¹ä¸å¯¹å…³æˆ‘piså•Šï¼ï¼ï¼@#ï¿¥%â€¦â€¦&amp;*</p>
<p>ä¸€åº¦æ€€ç–‘æˆ‘æ˜¯ä¸æ˜¯åšé”™äº†ï¼Œæ˜¯ä¸æ˜¯appé‡Œè¿˜è—äº†ç§é’¥ï¼ˆç„¶è€Œå¹¶æ²¡æœ‰ï¼‰</p>
<p>èŠ±äº†å¤§åŠå¤©è¿˜æ˜¯è§£å†³ä¸äº†ï¼Œæœ€åç”¨javaå†™äº†ä¸ªç”¨å…¬é’¥è§£å¯†çš„ç±»ã€‚ã€‚ã€‚</p>
<p>åˆ†æä¸ä¸‹å»äº†ï¼Œé‚£ä¹ˆå¼€å§‹é€†å‘å§- -ll</p>
<h2 id="è„±å£³"><a href="#è„±å£³" class="headerlink" title="è„±å£³"></a>è„±å£³</h2><p>AppStoreä¸‹è½½ä¸‹æ¥çš„ipaéƒ½æ˜¯ç»è¿‡åŠ å¯†çš„ï¼Œè§£å‹å‡º.appï¼Œç”¨<code>otool</code>å¯ä»¥çœ‹åˆ°äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¿¡æ¯é‡Œï¼Œæœ‰ä¸€ä¸ª<code>cryptid</code>å­—æ®µï¼Œ1ä»£è¡¨è¢«åŠ å¯†ï¼Œ0å°±æ˜¯æ²¡åŠ å¯†ï¼Œè§£å¯†çš„è¿‡ç¨‹è¢«ç§°ä½œè„±å£³</p>
<p>è·å–è„±å£³åçš„åº”ç”¨æœ‰ä¸¤ç§é€”å¾„ï¼š</p>
<ol>
<li><p>ä»PPåŠ©æ‰‹ç­‰è¶Šç‹±å¸‚åœºä¸‹è½½è¶Šç‹±åº”ç”¨ï¼Œæ¯”è¾ƒçœäº‹ï¼Œç¼ºç‚¹æ˜¯å†·é—¨appä½ ä¸ä¸€å®šæ‰¾å¾—åˆ°ï¼ˆæˆ–æ˜¯Surgeè¿™ç§ç‰¹æ®Šçš„appï¼Œåº”è¯¥ä¸ç®—å†·é—¨å§ï¼Œä½†æ˜¯è¶Šç‹±å¸‚åœºéƒ½æ˜¯æ‰¾ä¸åˆ°çš„ï¼‰</p>
</li>
<li><p>è‡ªè¡Œç ¸å£³/è„±å£³ï¼Œä½¿ç”¨<a href="https://github.com/stefanesser/dumpdecrypted" target="_blank" rel="noopener">dumpdecrypted</a>ã€<a href="https://github.com/KJCracks/Clutch" target="_blank" rel="noopener">Clutch</a>å·¥å…·ï¼ˆéœ€è¦ä¸€å°è¶Šç‹±çš„è®¾å¤‡ï¼‰ç ¸å£³åå†ç”¨sshã€scpä¹‹ç±»çš„æ‹·è´åˆ°macä¸Šï¼Œç•¥ä¸ºç¹ç</p>
</li>
</ol>
<h2 id="é‡ç­¾å"><a href="#é‡ç­¾å" class="headerlink" title="é‡ç­¾å"></a>é‡ç­¾å</h2><p>æŒ‰ç†è¶Šç‹±æ‰‹æœºæ˜¯æ²¡æœ‰è¿™ä¸ªé—®é¢˜çš„å§ï¼Ÿã€‚ã€‚å¯èƒ½9.3.3æ˜¯ä¸å®Œç¾è¶Šç‹±çš„ç¼˜æ•…</p>
<p>æ›¿æ¢æˆæœ‰æ•ˆçš„bundle_id, codesigning_identity, privisioning_profileï¼Œå†å¯¹appé‡æ–°æ‰“åŒ…ï¼Œå°±å¯ä»¥åœ¨æ‰‹æœºä¸Šå®‰è£…äº†ï¼ˆåŒ…æ‹¬éè¶Šç‹±è®¾å¤‡ï¼‰</p>
<p>è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨<a href="https://github.com/DanTheMan827/ios-app-signer" target="_blank" rel="noopener">iOS App Signer</a>å®ç°ï¼Œè¿˜ç®—æ–¹ä¾¿</p>
<h2 id="å®‰è£…è¶Šç‹±ç›¸å…³å·¥å…·"><a href="#å®‰è£…è¶Šç‹±ç›¸å…³å·¥å…·" class="headerlink" title="å®‰è£…è¶Šç‹±ç›¸å…³å·¥å…·"></a>å®‰è£…è¶Šç‹±ç›¸å…³å·¥å…·</h2><p>ä¸€å¤§å †ä¸œè¥¿ï¼Œæœ‰çš„æ²¡çš„åæ­£èƒ½è£…çš„éƒ½è£…ä¸Šå§ã€‚ã€‚</p>
<ul>
<li>iOSOpenDevï¼ˆè¶Šç‹±å¼€å‘ç¯å¢ƒï¼‰</li>
<li>theosï¼ˆåŒä¸Šï¼‰</li>
<li><a href="http://www.cycript.org/" target="_blank" rel="noopener">cycript</a></li>
<li><a href="https://github.com/KJCracks/Clutch" target="_blank" rel="noopener">Clutch</a></li>
<li><a href="https://github.com/nygard/class-dump" target="_blank" rel="noopener">class-dump</a>ï¼ˆä»Mach-Oæ–‡ä»¶ä¸­ï¼Œå¯¼å‡ºæ‰€æœ‰OCç±»çš„å¤´æ–‡ä»¶ï¼‰</li>
<li>mobiledeviceï¼ˆç›´æ¥å®‰è£…ipaåˆ°æ‰‹æœºä¸Šï¼‰</li>
<li>ideviceinstallerï¼ˆåŒä¸Šï¼‰</li>
<li><a href="https://github.com/KJCracks/yololib" target="_blank" rel="noopener">yololib</a>ï¼ˆå°†dylibæ³¨å…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒHook Appï¼‰</li>
<li>Hopperï¼ˆMacåç¼–è¯‘å·¥å…·ï¼‰</li>
</ul>
<p>iOSç‰ˆæœ¬å¤ªæ–°è¿˜æ˜¯è›®å°´å°¬çš„ï¼Œè¶Šç‹±ç›¸å…³çš„å·¥å…·ä¸€èˆ¬ä¸ä¼šå¾ˆå¿«çš„æ›´æ–°ï¼Œç”šè‡³æœ‰äº›éƒ½ä¸ç»´æŠ¤äº†ï¼Œå†åŠ ä¸Š9.3.3æ˜¯ä¸å®Œç¾è¶Šç‹±ï¼Œå¯¼è‡´éƒ¨åˆ†å·¥å…·ä¸å¯ç”¨ï¼ˆcycriptï¼‰ï¼Œéƒ¨åˆ†æ•™ç¨‹ä¸å¯å‚è€ƒï¼Œé‡ä¸Šäº†å¾ˆå¤šå›°éš¾ã€‚</p>
<p>å†ç”±äºæˆ‘è¦ç ´è§£çš„appæ˜¯swiftå†™çš„ï¼Œclass-dumpä¸å¯ç”¨ï¼ŒiOSOpenDevæ–°å»ºçš„æ¨¡æ¿ä¹Ÿæ²¡æ³•ç›´æ¥ç”¨ï¼Œäºšå†å±±å¤§å•Šâ•®(â•¯â–½â•°)â•­</p>
<h2 id="å¯»æ‰¾è¦Hookçš„ç›®æ ‡"><a href="#å¯»æ‰¾è¦Hookçš„ç›®æ ‡" class="headerlink" title="å¯»æ‰¾è¦Hookçš„ç›®æ ‡"></a>å¯»æ‰¾è¦Hookçš„ç›®æ ‡</h2><p>å…ˆåˆ—å‡ºappæ‰€æœ‰ç±»åå’Œæ–¹æ³•åã€‚class-dumpã€flex3ã€hopperè¿™äº›éƒ½èƒ½ç”¨ï¼Œå…¶ä¸­class-dumpå¯ä»¥ç›´æ¥å¯¼å‡ºæ‰€æœ‰å¤´æ–‡ä»¶ï¼Œä¸è¿‡æš‚ä¸æ”¯æŒswiftã€‚</p>
<p>ç”±äºOCçš„runtimeæœºåˆ¶ï¼Œæ–¹æ³•éƒ½æ˜¯åŠ¨æ€çš„ï¼Œå¦‚æœåƒjavaé‚£æ ·ç›´æ¥æ··æ·†ç±»åå’Œæ–¹æ³•åï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒç”¨æ–¹æ³•å°±ä¼šå‡ºé”™å§ã€‚æ‰€ä»¥èƒ½ä»ç±»åé‡Œè·å–åˆ°å¾ˆå¤šä¿¡æ¯ã€‚</p>
<p>ï¼ˆå¸Œæœ›ä»¥åèƒ½æœ‰è¿™æ–¹é¢çš„åŠ å¯†å·¥å…·ï¼Œæ‰¾åˆ°è¿‡å‡ ä¸ªç›¸å…³çš„è„šæœ¬æ„Ÿè§‰ä¸æ˜¯å¤ªå¯é ï¼Œå¹¶ä¸”éœ€è¦ä¿®æ”¹ä»£ç é…åˆæ··æ·†ï¼Œæœ‰ä¸€å®šçš„å¼€å‘é‡ï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼‰</p>
<p>å¤§è‡´ç¡®å®šäº†å‡ ä¸ªç›®æ ‡ï¼š</p>
<ul>
<li><code>[SecurityUtil encryptAESData:app_key:]</code></li>
<li><code>[SecurityUtil decryptAESData:app_key:]</code></li>
<li><code>[MindAsset.RSAUtils addRSAPrivateKey:tagName:]</code></li>
<li><code>[MindAsset.RSAUtils addRSAPublicKey:tagName:]</code></li>
<li><code>[MindAsset.HttpManager uploadDataToAliyun:accessKeyId:secretKeyId:sucessblock:]</code></li>
</ul>
<p>æˆ‘å°è¯•çš„æ–¹æ¡ˆæ˜¯ï¼šç¼–å†™dylibæ³¨å…¥åˆ°åº”ç”¨ä¸­ï¼Œåœ¨åº”ç”¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œswizzleè¿™å‡ ä¸ªæ–¹æ³•ï¼Œç„¶ååœ¨è®¾å¤‡æ—¥å¿—é‡Œæ‰¾åˆ°æˆ‘æ‰“å°çš„æ—¥å¿—ï¼Œåˆ†æçº¿ç´¢</p>
<p>ä¸ºä»€ä¹ˆä¸ç›´æ¥è°ƒè¯•appå‘¢(â•¯â€µâ–¡â€²)â•¯ï¸µâ”»â”â”»</p>
<p>æˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œè¯•äº†ä¸€ä¸‹è°ƒè¯•ä¸äº†ã€‚ã€‚æœ‰ç©ºå†ç¢ç£¨ä¸€ä¸‹ä¸ºä»€ä¹ˆ</p>
<p>æ„Ÿè§‰ç›´æ¥è°ƒè¯•ä¼šæ›´æ–¹ä¾¿</p>
<h2 id="å¼€å§‹Hook"><a href="#å¼€å§‹Hook" class="headerlink" title="å¼€å§‹Hook"></a>å¼€å§‹Hook</h2><p>æ–°å»ºXcodeé¡¹ç›®ï¼Œé€‰æ‹©<code>CaptainHook Tweak</code>æ¨¡æ¿ï¼Œ<code>*.xm</code>æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯ä»¥ç”¨<code>%hook</code>ã€<code>%log</code>ã€<code>%orig</code>æ–¹ä¾¿çš„å¯¹æŸä¸ªç±»çš„æ–¹æ³•è¿›è¡Œhookã€‚</p>
<p>xmæ–‡ä»¶å¤´éƒ¨å®šä¹‰äº†ä¸€ä¸ªerrorï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#error iOSOpenDev post-project creation from template requirements (remove these lines after completed) -- \</span><br><span class="line">	Link to libsubstrate.dylib: \</span><br><span class="line">	(1) go to TARGETS &gt; Build Phases &gt; Link Binary With Libraries and add /opt/iOSOpenDev/lib/libsubstrate.dylib \</span><br><span class="line">	(2) remove these lines from *.xm files (not *.mm files as they&apos;re automatically generated from *.xm files)</span><br></pre></td></tr></table></figure>
<p>éœ€è¦ä»ä½ çš„<code>iOSOpenDev</code>ç›®å½•é‡Œå¼•å…¥<code>libsubstrate.dylib</code>ï¼Œç„¶åæŠŠè¿™æ®µerroræ³¨é‡Šæ‰å°±å¥½äº†ã€‚åœ¨buildçš„æ—¶å€™é¡¹ç›®ä¼šè·‘ä¸€ä¸ªè„šæœ¬å¯¹è¿™äº›æ ‡è®°è¿›è¡Œæ›¿æ¢ï¼Œå†ç”¨å®å®šä¹‰å¼•å…¥è‡³<code>*.mm</code>æ–‡ä»¶ä¸­ï¼Œç¼–è¯‘æˆdylibã€‚</p>
<p>xmæ–‡ä»¶ç”¨ç€ä¸å¤ªä¹ æƒ¯ï¼Œæ²¡æœ‰è¯­æ³•é«˜äº®äº†ã€‚ã€‚ç›´æ¥åƒå¹³æ—¶å¼€å‘çš„æ—¶å€™é‚£æ ·åŠ ä¸ªcategoryï¼Œè‡ªå·±å†™swizzleä¹Ÿå¯ä»¥ã€‚ã€‚</p>
<p><a href="http://iphonedevwiki.net/index.php/Logos" target="_blank" rel="noopener">xmæ–‡ä»¶å†™æ³•-Logos</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">%hook SecurityUtil</span><br><span class="line"></span><br><span class="line">+ (id)encryptAESData:(id)data app_key:(id)key &#123;</span><br><span class="line">    </span><br><span class="line">    id result = %orig(data, key);</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;encryptAESData &apos;%@&apos; &apos;%@&apos; &apos;%@&apos;&quot;, data, key, result);</span><br><span class="line">    </span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (id)decryptAESData:(id)data app_key:(id)key &#123;</span><br><span class="line">    </span><br><span class="line">    id result = %orig(data, key);</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;decryptAESData &apos;%@&apos; &apos;%@&apos; &apos;%@&apos;&quot;, data, key, result);</span><br><span class="line">    </span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">%end</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘ååœ¨Productsæ‰¾åˆ°ç¼–è¯‘å¥½çš„dylibï¼Œç„¶åç”¨yololibå·¥å…·æŠŠå®ƒæ³¨å…¥åˆ°Mach-Oæ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â†’ ./yololib MindAsset hook.dylib</span><br><span class="line">2016-08-23 22:24:50.338 yololib[71513:1121551] dylib path @executable_path/hook.dylib</span><br><span class="line">2016-08-23 22:24:50.351 yololib[71513:1121551] dylib path @executable_path/hook.dylib</span><br><span class="line">Reading binary: MindAsset</span><br><span class="line"></span><br><span class="line">2016-08-23 22:24:50.351 yololib[71513:1121551] Thin 64bit binary!</span><br><span class="line">2016-08-23 22:24:50.351 yololib[71513:1121551] dylib size wow 56</span><br><span class="line">2016-08-23 22:24:50.352 yololib[71513:1121551] mach.ncmds 60</span><br><span class="line">2016-08-23 22:24:50.352 yololib[71513:1121551] mach.ncmds 61</span><br><span class="line">2016-08-23 22:24:50.352 yololib[71513:1121551] Patching mach_header..</span><br><span class="line">2016-08-23 22:24:50.352 yololib[71513:1121551] Attaching dylib..</span><br><span class="line"></span><br><span class="line">2016-08-23 22:24:50.352 yololib[71513:1121551] size 51</span><br><span class="line">2016-08-23 22:24:50.352 yololib[71513:1121551] complete!</span><br></pre></td></tr></table></figure>
<p>å†æŠŠMach-Oå’Œdylibä¸€åŒå¤åˆ¶å›.appç›®å½•ä¸‹ï¼Œé‡æ–°æ‰“åŒ…ç­¾åï¼Œè£…ä¸Šæ‰‹æœºè¿è¡Œï¼Œç”¨Xcodeæˆ–è€…å‘½ä»¤è¡Œå·¥å…·<code>idevicesyslog</code>æŸ¥çœ‹æ‰‹æœºè¿è¡Œæ—¥å¿—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Aug 29 00:15:48 iPhone7s MindAsset[11330] &lt;Warning&gt;: encryptAESData &apos;&#123;&quot;password&quot;:&quot;123456&quot;,&quot;version&quot;:&quot;1.0.22&quot;,&quot;mobile&quot;:&quot;18000000000&quot;,&quot;platform&quot;:&quot;iOS&quot;&#125;&apos; &apos;fucgqsdlefath&apos; &apos;YV4F2uYUK3BmM90at/5leyfsz7/OJ+V/k8WTyC0WYrP4M1zbSZdIP47XxuPaXXCsRRdCf0YeldRtMBwCbRNc9rTgNgTz+BGWQ/iaYubbVv71w8yMJ/gCDu8nL8ijoeKl&apos;</span><br><span class="line">Aug 29 00:15:48 iPhone7s MindAsset[11330] &lt;Warning&gt;: decryptAESData &apos;&lt;1c4e3425 bff4c6ec 525dd10b b3afc339 944337ff 9d5a2ef3 066d7e07 0d05bf22 8e623abf a80be7c1 555cd64c ba436103 61830f09 b34e99a1 a29f3d4a 0800ca50 effb627e baf387bf 00b8a175 7f3b3b97 93fcbb47 68984e88 8828f665 775af738 2620e5b8 53127e7b 4ba016bb c77b5ad6 e5ec0e20 640f6608 625fb4da 9078e1ed 5257e9da 192d55bc 1f3c4ffa 3679f358 5dd79f05 3b7652e4 de0f2e07 10f44396 bd8a1ec0 3a181590 6dccbee6 ddb96f8b bf9a22b5 4878833d ff624f0a 41377208 5532679e 5b5d6145 914d61ae 0fa42ca5 67807fa2 98775bd8 8badae71 be95363b ea22806c 49c7e0fc 11eb86fb 58e5a0af efc902e8 407bd0e0 019cc2bb 8a841c65&gt;&apos; &apos;5Mvk20CB&apos; &apos;&#123;&quot;status&quot;:0,&quot;data&quot;:&#123;&quot;uid&quot;:xxx,&quot;invitor_name&quot;:&quot;xxx&quot;,&quot;huanxin_id&quot;:&quot;xxx&quot;,&quot;huanxin_pwd&quot;:&quot;xxx&quot;,&quot;in_use_huanxin_customer&quot;:1,&quot;waiter_id&quot;:&quot;xxx&quot;,&quot;waiter_name&quot;:&quot;xxx&quot;&#125;&#125;&apos;</span><br></pre></td></tr></table></figure>
<p>HookæˆåŠŸäº†ï¼Œå‘ç°ç¡®å®è°ƒç”¨äº†AESæ–¹æ³•ï¼Œä½†æ˜¯æ¯æ¬¡åŠ å¯†è§£å¯†çš„aesKeyéƒ½æ˜¯ä¼šå˜çš„ï¼Œçœ‹ç€åƒéšæœºç”Ÿæˆçš„ï¼Œé‚£ä¹ˆè”æƒ³åˆ°apkæ–‡ä»¶é‡Œæ‰¾åˆ°çš„RSAå…¬é’¥ï¼Œå†å¯¹RSAçš„åŠ è§£å¯†æ–¹æ³•hookä¸€ä¸‹çœ‹çœ‹</p>
<h2 id="Cå‡½æ•°Hook"><a href="#Cå‡½æ•°Hook" class="headerlink" title="Cå‡½æ•°Hook"></a>Cå‡½æ•°Hook</h2><p>ä¹‹å‰æŸ¥çœ‹äº†ä¸€ä¸‹åº”ç”¨æ‰€æœ‰ç”¨åˆ°çš„ç±»ï¼Œæ²¡æœ‰ç¬¬ä¸‰æ–¹çš„åŠ å¯†åº“ï¼Œé‚£ä¹ˆæˆ‘çŒœç”¨çš„æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„<code>SecKeyEncrypt</code>ã€<code>SecKeyDecrypt</code>æ–¹æ³•</p>
<p>Cå‡½æ•°ä¹Ÿæ˜¯å¯ä»¥hookæ»´ï¼Œç”¨facebookçš„<a href="https://github.com/facebook/fishhook" target="_blank" rel="noopener">fishhook</a>å§</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;fishhook/fishhook.h&gt;</span><br><span class="line">#import &lt;dlfcn.h&gt;</span><br><span class="line">#import &lt;CommonCrypto/CommonCrypto.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//SecKeyEncrypt</span><br><span class="line">static OSStatus (*orig_SecKeyEncrypt)(SecKeyRef, SecPadding, const uint8_t *, size_t, uint8_t *, size_t *);</span><br><span class="line">static OSStatus my_SecKeyEncrypt(</span><br><span class="line">                                 SecKeyRef key,</span><br><span class="line">                                 SecPadding padding,</span><br><span class="line">                                 const uint8_t *plainText,</span><br><span class="line">                                 size_t plainTextLen,</span><br><span class="line">                                 uint8_t *cipherText,</span><br><span class="line">                                 size_t *cipherTextLen) &#123;</span><br><span class="line"></span><br><span class="line">    OSStatus result = orig_SecKeyEncrypt(key, padding, plainText, plainTextLen, cipherText, cipherTextLen);</span><br><span class="line">    </span><br><span class="line">    NSData *cipherData = nil;</span><br><span class="line">    NSData *plainData = nil;</span><br><span class="line">//    NSData *cipherData = [NSData dataWithBytesNoCopy:cipherText length:cipherTextLen];</span><br><span class="line">//    NSData *plainData = [NSData dataWithBytesNoCopy:(void *)plainText length:plainTextLen];</span><br><span class="line">    NSLog(@&quot;SecKeyEncrypt SecPadding: %d, plainData: %@, cipherData: %@&quot;, padding, plainData, cipherData);</span><br><span class="line">    </span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//SecKeyDecrypt</span><br><span class="line">static OSStatus (*orig_SecKeyDecrypt)(SecKeyRef, SecPadding, const uint8_t *, size_t, uint8_t *, size_t *);</span><br><span class="line">static OSStatus my_SecKeyDecrypt(</span><br><span class="line">                                 SecKeyRef key,</span><br><span class="line">                                 SecPadding padding,</span><br><span class="line">                                 const uint8_t *cipherText,</span><br><span class="line">                                 size_t cipherTextLen,</span><br><span class="line">                                 uint8_t *plainText,</span><br><span class="line">                                 size_t *plainTextLen) &#123;</span><br><span class="line"></span><br><span class="line">    OSStatus result = orig_SecKeyDecrypt(key, padding, cipherText, cipherTextLen, plainText, plainTextLen);</span><br><span class="line">    </span><br><span class="line">    NSData *cipherData = nil;</span><br><span class="line">    NSData *plainData = nil;</span><br><span class="line">//    NSData *cipherData = [NSData dataWithBytesNoCopy:(void *)cipherText length:cipherTextLen];</span><br><span class="line">//    NSData *plainData = [NSData dataWithBytesNoCopy:plainText length:plainTextLen];</span><br><span class="line">    NSLog(@&quot;SecKeyDecrypt SecPadding: %d, cipherData: %@, plainData: %@&quot;, padding, cipherData, plainData);</span><br><span class="line">    </span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//CCCryptorCreate</span><br><span class="line">static CCCryptorStatus (*orig_CCCryptorCreate)(CCOperation, CCAlgorithm, CCOptions, const void *, size_t, const void *, CCCryptorRef *);</span><br><span class="line">static CCCryptorStatus my_CCCryptorCreate(</span><br><span class="line">                                          CCOperation op,</span><br><span class="line">                                          CCAlgorithm alg,</span><br><span class="line">                                          CCOptions options,</span><br><span class="line">                                          const void *key,</span><br><span class="line">                                          size_t keyLength,</span><br><span class="line">                                          const void *iv,</span><br><span class="line">                                          CCCryptorRef *cryptorRef) &#123;</span><br><span class="line"></span><br><span class="line">    CCCryptorStatus result = my_CCCryptorCreate(op, alg, options, key, keyLength, iv, cryptorRef);</span><br><span class="line">    </span><br><span class="line">    NSData *keyData = [NSData dataWithBytesNoCopy:(void *)key length:keyLength];</span><br><span class="line">    NSData *ivData = [NSData dataWithBytesNoCopy:(void *)iv length:keyLength];</span><br><span class="line">    NSLog(@&quot;CCCryptorCreate CCOperation: %d, CCAlgorithm: %d, CCOptions: %d, key: %@, iv: %@&quot;, op, alg, options, keyData, ivData);</span><br><span class="line">    </span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@implementation NSObject (FishHook)</span><br><span class="line"></span><br><span class="line">+ (void)load &#123;</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;fishhook start&quot;);</span><br><span class="line">    </span><br><span class="line">    orig_SecKeyEncrypt = dlsym(RTLD_DEFAULT, &quot;SecKeyEncrypt&quot;);</span><br><span class="line">    orig_SecKeyDecrypt = dlsym(RTLD_DEFAULT, &quot;SecKeyDecrypt&quot;);</span><br><span class="line">    orig_CCCryptorCreate = dlsym(RTLD_DEFAULT, &quot;CCCryptorCreate&quot;);</span><br><span class="line">    </span><br><span class="line">    rebind_symbols((struct rebinding[3])&#123;</span><br><span class="line">        &#123;&quot;SecKeyEncrypt&quot;, my_SecKeyEncrypt&#125;,</span><br><span class="line">        &#123;&quot;SecKeyDecrypt&quot;, my_SecKeyDecrypt&#125;,</span><br><span class="line">        &#123;&quot;CCCryptorCreate&quot;, my_CCCryptorCreate&#125;,</span><br><span class="line">//        &#123;&quot;SecKeyEncrypt&quot;, my_SecKeyEncrypt, (void *)orig_SecKeyEncrypt&#125;,</span><br><span class="line">//        &#123;&quot;SecKeyDecrypt&quot;, my_SecKeyDecrypt, (void *)orig_SecKeyDecrypt&#125;,</span><br><span class="line">    &#125;, 3);</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;fishhook end&quot;);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>åæ­£å°±å¤§æ¦‚è¿™ä¹ˆä¸ªæ„æ€ã€‚ã€‚ã€‚æœ€åæ²¡æœ‰ä»è¿™å„¿è·å¾—å•¥ä¿¡æ¯ğŸ˜·</p>
<p>æ‹¿æ‰‹æœºæ—¥å¿—å’Œç½‘ç»œè¯·æ±‚å¯¹æ¯”ï¼Œå°±ææ¸…æ¥šæ¯ä¸ªæ¥å£çš„è¯·æ±‚æ ¼å¼äº†ã€‚è‡³äºå‰é¢éšæœºç”Ÿæˆçš„aesKeyï¼Œç»RSAå…¬é’¥åŠ å¯†ï¼Œéšç½‘ç»œè¯·æ±‚è—åœ¨äº†HTTP Headerä¸­ï¼ŒResponseä¹Ÿæ˜¯ä¸€æ ·ã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>iOSçš„å®‰å…¨æ€§è¢«å¾ˆå¤šäººç»™å¿½è§†äº†ï¼Œæ²¡æƒ³åˆ°ä¹Ÿæ˜¯æŒºè„†å¼±çš„ã€‚ã€‚</p>
<p>ä»è¿™æ¬¡å°è¯•ä¸­å‘ç°è¿˜æ˜¯æœ‰å¾ˆå¤šè¿æ°”çš„æˆåˆ†çš„â•®(â•¯â–½â•°)â•­</p>
<p>é¦–å…ˆè¦çŒœçš„åˆ°å¤§æ¦‚çš„å…³é”®è¯ï¼Œæ‰¾åˆ°åŠ å¯†è§£å¯†ç›¸å…³ç±»ï¼Œç„¶åhookçœ‹æ—¥å¿—ï¼Œå†å’Œç½‘ç»œè¯·æ±‚çš„æ•°æ®è¿›è¡Œå¯¹æ¯”ï¼Œæœ€åææ¸…æ¥šæ•°æ®ç»“æ„ï¼Œå†™å‡ºä¼ªé€ è¯·æ±‚çš„è„šæœ¬ã€‚</p>
<p>é‡åˆ°çš„å›°éš¾ä¸»è¦æ˜¯ï¼š</p>
<ul>
<li>åˆšå‡ºçš„9.3.3ä¸å®Œç¾è¶Šç‹±ï¼Œéƒ¨åˆ†å·¥å…·ä¸å¯ç”¨</li>
<li>åŸºæœ¬æ˜¯çº¯swiftå†™çš„appï¼Œæ²¡hookæˆåŠŸï¼Œç”¨hopperçœ‹å…·ä½“å®ç°å¾ˆå›°éš¾ï¼Œæœ‰ç‚¹æ— ä»ä¸‹æ‰‹ã€‚ã€‚</li>
</ul>
<p>æ„Ÿè§‰åº”è¯¥æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œæˆ‘çš„è¿™ä¸ªæµç¨‹ï¼ˆç¼–ç ï¼Œç¼–è¯‘dylibï¼Œæ³¨å…¥ï¼Œæ‰“åŒ…ï¼Œé‡ç­¾åï¼Œå®‰è£…ï¼Œçœ‹æ—¥å¿—ï¼‰å¤ªé•¿äº†ğŸ˜·</p>
<p>æœ‰ç©ºç»§ç»­ç ”ç©¶</p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/09/19/iot-wifi-config-notes/" class="prev">PREV</a><a href="/2016/07/09/fake-icloud/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = '0x5e';
var disqus_identifier = '2016/08/24/ios-hook-summary/';
var disqus_title = 'iOSé€†å‘å·¥ç¨‹å®è·µ';
var disqus_url = 'https://blog.0x5e.cn/2016/08/24/ios-hook-summary/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//0x5e.disqus.com/count.js" async></script><div class="copyright"><p>Â© 2016 - 2019 <a href="https://blog.0x5e.cn">0x5e</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p><p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-102733496-1",'auto');ga('send','pageview');</script></body></html>